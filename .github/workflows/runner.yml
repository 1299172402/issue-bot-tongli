name: Download Tongli Manga (issues)

on:
  issues:
    types: [opened]

jobs:
  build:
    if: ${{ github.event.labels.0.name == 'Runner' }}
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Comment the issue
        run: |
          curl \
            -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: token $GHP_TONGLI" \
            https://api.github.com/repos/1299172402/tongli-new/issues/$ISSUE_NUMBER/comments \
            -d '{"body":"[bot] 已收到你的请求，开始处理"}'
        env:
          GHP_TONGLI: ${{ secrets.GHP_TONGLI }}
          NUMBER: ${{ github.event.issue.number }}

      - name: Setup Python
        uses: actions/setup-python@v4.2.0
        with:
          python-version: 3.10.6

      - name: Start Download
        run: |
          pip install -r requirements.txt
          python trigger.py
        env: 
          GHP_TONGLI: ${{ secrets.GHP_TONGLI }}
          WORKFLOW_URL: ${{ secrets.WORKFLOW_URL }}
          ACTION_URL: ${{ secrets.ACTION_URL }}
          NUMBER: ${{ github.event.issue.number }}
